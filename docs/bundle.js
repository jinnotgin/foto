var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function r(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function s(t){t.parentNode.removeChild(t)}function l(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function u(){return d(" ")}function f(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function m(t,e){e=""+e,t.data!==e&&(t.data=e)}let g;function h(t){g=t}function p(t){(function(){if(!g)throw new Error("Function called outside component initialization");return g})().$$.on_mount.push(t)}const $=[],y=Promise.resolve();let b=!1;const v=[],S=[],_=[];function w(t){S.push(t)}function I(){const t=new Set;do{for(;$.length;){const t=$.shift();h(t),x(t.$$)}for(;v.length;)v.shift()();for(;S.length;){const e=S.pop();t.has(e)||(e(),t.add(e))}}while($.length);for(;_.length;)_.pop()();b=!1}function x(t){t.fragment&&(t.update(t.dirty),o(t.before_render),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_render.forEach(w))}function P(t,n,i){const{fragment:a,on_mount:c,on_destroy:s,after_render:l}=t.$$;a.m(n,i),w(()=>{const n=c.map(e).filter(r);s?s.push(...n):o(n),t.$$.on_mount=[]}),l.forEach(w)}function k(t,e){t.$$.dirty||($.push(t),b||(b=!0,y.then(I)),t.$$.dirty=n()),t.$$.dirty[e]=!0}function E(e,r,i,a,c,s){const l=g;h(e);const d=r.props||{},u=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(l?l.$$.context:[]),callbacks:n(),dirty:null};let f=!1;var m;u.ctx=i?i(e,d,(t,n)=>{u.ctx&&c(u.ctx[t],u.ctx[t]=n)&&(u.bound[t]&&u.bound[t](n),f&&k(e,t))}):d,u.update(),f=!0,o(u.before_render),u.fragment=a(u.ctx),r.target&&(r.hydrate?u.fragment.l((m=r.target,Array.from(m.childNodes))):u.fragment.c(),r.intro&&e.$$.fragment.i&&e.$$.fragment.i(),P(e,r.target,r.anchor),I()),h(l)}class A{$destroy(){var e,n;n=!0,(e=this).$$&&(o(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}const C={API_KEY:"AIzaSyCAr4_7aSMmQ4kLnR5cbqnCYbLdPPtw2Hw",CLIENT_ID:"273033434753-laf0qm75cehad2f7p7uuv8ppnvq6753a.apps.googleusercontent.com"};function T(t){var e,n,o,r;return{c(){(e=l("h1")).textContent="You are not authenticated.",n=u(),(o=l("button")).textContent="authorize and load",r=f(o,"click",t.click_handler)},m(t,r){c(t,e,r),c(t,n,r),c(t,o,r)},d(t){t&&(s(e),s(n),s(o)),r()}}}function N(e){return{c:t,m:t,d:t}}function L(e){var n,r;function i(t){return t.googlePhotosClientLoaded?N:T}var a=i(e),d=a(e);return{c(){n=l("div"),d.c(),n.className="content svelte-1p2f574",r=[f(n,"click",e.click_handler_1),f(n,"dblclick",e.dblclick_handler),f(n,"taphold",e.taphold_handler)]},m(t,e){c(t,n,e),d.m(n,null)},p(t,e){a!==(a=i(e))&&(d.d(1),(d=a(e))&&(d.c(),d.m(n,null)))},i:t,o:t,d(t){t&&s(n),d.d(),o(r)}}}const D=30,q=60;function M(t,e,n){let{db:o}=e;console.log({db:o});let r=!1;function i(){return gapi.client.setApiKey(C.API_KEY),gapi.client.load("https://content.googleapis.com/discovery/v1/apis/photoslibrary/v1/rest").then(function(){n("googlePhotosClientLoaded",r=!0),console.log("GAPI client loaded for API"),async function(){const t=await o.photos.orderBy("modified").reverse().limit(100).toArray(),e=t.reduce((t,e)=>t+e.modified,0)/t.length;console.log("clearOldPhotos:",{newlyUpdatedPhotos:t,averageModifiedTime:e,inactiveTolerance:604800});const n=e-604800,r=await o.photos.where("modified").below(n).delete();console.log("clearOldPhotos:",{deleteTransaction:r})}(),s(0),u(0)},function(t){console.error("Error loading GAPI client for API",t)})}const a={},c=(t,e,n)=>{console.log("scheduleFunction:",{functionName:t,scheduleSeconds:n}),((t,e,n)=>{const o={schedule:()=>{clearInterval(a[t]),a[t]=setTimeout(n.function,n.timeout)}};!1===Object.keys(a).includes(t)&&(a[t]=!1),o[e]()})(t,"schedule",{function:e,timeout:1e3*n})};const s=(t=D)=>c("displayRandomPhoto",l,t);async function l(){const t=await o.photos.count(),e=Math.round(Math.random()*t),n=await o.photos.offset(e).limit(1).first(),r=n.id;return console.log("displayRandomPhoto:",{totalNoOfPhotos:t,randomPhotoIndex:e,randomPhotoItem:n,randomPhotoId:r}),gapi.client.photoslibrary.mediaItems.get({mediaItemId:r}).then(function(t){console.log("Photo data (Google):",t),function(t){const e=new Image;e.onload=function(){document.querySelector("html").style.backgroundImage=`url(${e.src})`},e.src=t}(`${t.result.baseUrl}=w0-h0`),s()},function(t){console.error("Execute error",t),s(0)})}let d="";const u=(t=q)=>c("getPictures",f,t);function f(){return gapi.client.photoslibrary.mediaItems.search({resource:{pageSize:100,pageToken:d}}).then(async function(t){console.log("getPictures: ",t);const{result:e}=t,n=e.mediaItems.filter(t=>{return[t.mimeType.includes("image/"),!1===t.filename.toLowerCase().includes("screenshot")].every(t=>!0===t)}).map(t=>t.id),r=Math.round((new Date).getTime()/1e3);await o.photos.bulkPut(n.map(t=>({id:t,modified:r}))).catch(t=>{console.error("Dexie error",t)}),d=e.nextPageToken,u()},function(t){console.error("Execute error",t),u()})}return gapi.load("client:auth2",function(){gapi.auth2.init({client_id:C.CLIENT_ID}).then(()=>{gapi.auth2.getAuthInstance().isSignedIn.get()&&i()})}),t.$set=(t=>{"db"in t&&n("db",o=t.db)}),{db:o,googlePhotosClientLoaded:r,loadClient:i,schedule_displayRandomPhoto:s,document:document,click_handler:function(){return function(){const t=gapi.auth2.getAuthInstance();return t.isSignedIn.get()?console.log("User already signed in."):t.signIn({scope:"https://www.googleapis.com/auth/photoslibrary.readonly"}).then(function(){console.log("Sign-in successful")},function(t){console.error("Error signing in",t)}),t}().then(i)},click_handler_1:function(){return s(0)},dblclick_handler:function(){return document.body.requestFullscreen()},taphold_handler:function(){return document.body.requestFullscreen()}}}class O extends A{constructor(t){super(),E(this,t,M,L,i,["db"])}}function F(e){var n,o;return{c(){n=l("div"),o=d(e.timeString),n.className="svelte-5q5vyy"},m(t,e){c(t,n,e),a(n,o)},p(t,e){t.timeString&&m(o,e.timeString)},i:t,o:t,d(t){t&&s(n)}}}function z(t,e,n){let{timeString:o="0:00"}=e;return t.$set=(t=>{"timeString"in t&&n("timeString",o=t.timeString)}),{timeString:o}}class R extends A{constructor(t){super(),E(this,t,z,F,i,["timeString"])}}function Y(e){var n,o;return{c(){n=l("div"),o=d(e.photoSlogan),n.className="svelte-1so9xd0"},m(t,e){c(t,n,e),a(n,o)},p(t,e){t.photoSlogan&&m(o,e.photoSlogan)},i:t,o:t,d(t){t&&s(n)}}}function j(t,e,n){let{photoSlogan:o=""}=e;return t.$set=(t=>{"photoSlogan"in t&&n("photoSlogan",o=t.photoSlogan)}),{photoSlogan:o}}class G extends A{constructor(t){super(),E(this,t,j,Y,i,["photoSlogan"])}}function K(t){var e,n,o,r=new R({props:{timeString:t.timeString}}),i=new G({props:{photoSlogan:t.dateString}});return{c(){e=l("div"),r.$$.fragment.c(),n=u(),i.$$.fragment.c(),e.className="svelte-m3u4ae"},m(t,s){c(t,e,s),P(r,e,null),a(e,n),P(i,e,null),o=!0},p(t,e){var n={};t.timeString&&(n.timeString=e.timeString),r.$set(n);var o={};t.dateString&&(o.photoSlogan=e.dateString),i.$set(o)},i(t){o||(r.$$.fragment.i(t),i.$$.fragment.i(t),o=!0)},o(t){r.$$.fragment.o(t),i.$$.fragment.o(t),o=!1},d(t){t&&s(e),r.$destroy(),i.$destroy()}}}function U(t,e,n){let o=new Date;p(()=>{setInterval(()=>{n("time",o=new Date)},1e3)});let r,i;return t.$$.update=((t={time:1})=>{t.time&&n("timeString",r=(t=>{let e=t.getHours();return 0===e?e=12:e>12&&(e-=12),`${e}:${t.getMinutes().toString().padStart(2,"0")}`})(o)),t.time&&n("dateString",i=(t=>{const e=t.toDateString().split(" "),n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=n.map(t=>t.substr(0,3));return`${n[o.indexOf(e[0])]}, ${e[1]} ${e[2]}`})(o))}),{timeString:r,dateString:i}}class B extends A{constructor(t){super(),E(this,t,U,K,i,[])}}function H(t){var e,n,o=new O({props:{db:t.db}}),r=new B({});return{c(){o.$$.fragment.c(),e=u(),r.$$.fragment.c()},m(t,i){P(o,t,i),c(t,e,i),P(r,t,i),n=!0},p(t,e){var n={};t.db&&(n.db=e.db),o.$set(n)},i(t){n||(o.$$.fragment.i(t),r.$$.fragment.i(t),n=!0)},o(t){o.$$.fragment.o(t),r.$$.fragment.o(t),n=!1},d(t){o.$destroy(t),t&&s(e),r.$destroy(t)}}}function Q(t,e,n){let{name:o,version:r}=e;console.log(`Starting ${o} v${r}...`);let{db:i}=e;return n("db",i=new Dexie("fotoDatabase")),i.version(1).stores({photos:"id"}),i.version(2).stores({photos:"id, modified"}),t.$set=(t=>{"name"in t&&n("name",o=t.name),"version"in t&&n("version",r=t.version),"db"in t&&n("db",i=t.db)}),{name:o,version:r,db:i}}return new class extends A{constructor(t){super(),E(this,t,Q,H,i,["name","version","db"])}}({target:document.body,props:{name:"Foto",version:"0.21"}})}();
//# sourceMappingURL=bundle.js.map
